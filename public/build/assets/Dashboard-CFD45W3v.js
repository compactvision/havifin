import{c as q,j as t,L as A,r as D,a as z,u as B,b as H,H as I}from"./app-DATWHNMc.js";import{B as T}from"./badge-Ci_v76ag.js";import{B as k,t as E}from"./index-B7jdcb8K.js";import{h as M}from"./moment-B-YVwB4U.js";import{U as Q,S as G,A as K}from"./app-main-DgyKFYw0.js";import{C as P}from"./clock-C4KKNSxU.js";import{H as $}from"./history-Ct3Xt804.js";import{L as V}from"./lock-open-DAC-r5Nw.js";import{L as J}from"./lock-Bfcso9f1.js";import{D as W,a as X,b as Y,c as Z,d as ee,e as se}from"./dialog-BYjCO34Z.js";import{L as U,I as te}from"./label-CrBfHtu_.js";import{T as ae}from"./textarea-DMtPiRqH.js";import{u as le}from"./users-N7UzZr7_.js";import{A as re}from"./arrow-left-DgxoR9rr.js";/* empty css            */import"./createLucideIcon-Da68W3hK.js";function ie(e){const s=q.c(35),{register:a,onOpenSession:j}=e,l=a.active_session;a.balances;let n;s[0]!==a.name?(n=t.jsx("h3",{className:"text-xl font-black text-slate-900",children:a.name}),s[0]=a.name,s[1]=n):n=s[1];const d=a.shop?.name,b=a.counter?.name||"Sans guichet";let o;s[2]!==d||s[3]!==b?(o=t.jsxs("p",{className:"text-sm text-slate-500",children:[d," •"," ",b]}),s[2]=d,s[3]=b,s[4]=o):o=s[4];let m;s[5]!==n||s[6]!==o?(m=t.jsxs("div",{children:[n,o]}),s[5]=n,s[6]=o,s[7]=m):m=s[7];const N=`/cash/registers/${a.id}/history`;let r;s[8]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600",children:t.jsx($,{className:"h-4 w-4"})}),s[8]=r):r=s[8];let i;s[9]!==N?(i=t.jsx(A,{href:N,children:r}),s[9]=N,s[10]=i):i=s[10];const O=`rounded-full px-2 py-1 text-xs font-black uppercase ${l?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`;let x;s[11]!==l?(x=l?t.jsx(V,{className:"mr-1 h-3 w-3"}):t.jsx(J,{className:"mr-1 h-3 w-3"}),s[11]=l,s[12]=x):x=s[12];const w=l?"Ouverte":"Fermée";let h;s[13]!==x||s[14]!==w||s[15]!==O?(h=t.jsxs(T,{className:O,children:[x,w]}),s[13]=x,s[14]=w,s[15]=O,s[16]=h):h=s[16];let u;s[17]!==h||s[18]!==i?(u=t.jsxs("div",{className:"flex gap-2",children:[i,h]}),s[17]=h,s[18]=i,s[19]=u):u=s[19];let p;s[20]!==u||s[21]!==m?(p=t.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[m,u]}),s[20]=u,s[21]=m,s[22]=p):p=s[22];let f;s[23]!==l?(f=l?t.jsxs("div",{className:"space-y-4 rounded-2xl bg-slate-50 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-100 text-blue-600",children:t.jsx(Q,{className:"h-5 w-5"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Responsable"}),t.jsxs("div",{className:"font-bold text-slate-900",children:["Caissier #",l.user_id]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-orange-100 text-orange-600",children:t.jsx(P,{className:"h-5 w-5"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Ouverte depuis"}),t.jsx("div",{className:"font-bold text-slate-900",children:M(l.opened_at).fromNow()})]})]})]}):t.jsxs("div",{className:"flex min-h-[120px] flex-col items-center justify-center rounded-2xl border-2 border-dashed border-slate-100 bg-slate-50/50 text-center",children:[t.jsx("div",{className:"mb-2 rounded-full bg-slate-100 p-3 text-slate-400",children:t.jsx($,{className:"h-6 w-6"})}),t.jsx("p",{className:"font-bold text-slate-500",children:"Caisse fermée"})]}),s[23]=l,s[24]=f):f=s[24];let c;s[25]!==l||s[26]!==j||s[27]!==a?(c=l?t.jsx(A,{href:`/cash/sessions/${l.id}`,className:"block w-full",children:t.jsx(k,{className:"h-12 w-full rounded-xl bg-blue-600 font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 hover:shadow-xl",children:"Accéder à la session"})}):t.jsx(k,{onClick:()=>j(a),className:"h-12 w-full rounded-xl bg-slate-900 font-bold text-white shadow-lg shadow-slate-900/20 hover:bg-slate-800 hover:shadow-xl",children:"Ouvrir la caisse"}),s[25]=l,s[26]=j,s[27]=a,s[28]=c):c=s[28];let v;s[29]!==f||s[30]!==c?(v=t.jsxs("div",{className:"space-y-6",children:[f,c]}),s[29]=f,s[30]=c,s[31]=v):v=s[31];let g;return s[32]!==p||s[33]!==v?(g=t.jsxs("div",{className:"group relative overflow-hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-sm transition-all hover:shadow-lg",children:[p,v]}),s[32]=p,s[33]=v,s[34]=g):g=s[34],g}const ne=["USD","CDF","EUR"];function oe({register:e,isOpen:s,onClose:a,onSuccess:j}){const[l,n]=D.useState(!1),[d,b]=D.useState({USD:"0",CDF:"0",EUR:"0"}),[o,m]=D.useState(""),N=async r=>{if(r.preventDefault(),!!e){n(!0);try{await z.post("/api/cash/sessions",{cash_register_id:e.id,opening_amounts:d,notes:o}),E.success("Session ouverte avec succès"),j(),a()}catch(i){E.error(i.response?.data?.message||"Erreur lors de l'ouverture")}finally{n(!1)}}};return t.jsx(W,{open:s,onOpenChange:a,children:t.jsxs(X,{className:"sm:max-w-[425px]",children:[t.jsxs(Y,{children:[t.jsx(Z,{children:"Ouverture de Caisse - Fond de Caisse"}),t.jsxs(ee,{children:["Veuillez renseigner le ",t.jsx("strong",{children:"montant prévu"})," ","pour le début de journée (Fond de Caisse) pour"," ",e?.name,".",t.jsx("br",{}),"Ces montants constitueront le solde d'ouverture."]})]}),t.jsxs("form",{onSubmit:N,className:"grid gap-4 py-4",children:[t.jsx("div",{className:"grid gap-4",children:ne.map(r=>t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(U,{htmlFor:`amount-${r}`,className:"text-right font-bold",children:r}),t.jsx(te,{id:`amount-${r}`,type:"number",min:"0",step:"0.01",value:d[r],onChange:i=>b({...d,[r]:i.target.value}),className:"col-span-3"})]},r))}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(U,{htmlFor:"notes",className:"text-right",children:"Notes"}),t.jsx(ae,{id:"notes",value:o,onChange:r=>m(r.target.value),className:"col-span-3",placeholder:"Remarques éventuelles..."})]}),t.jsxs(se,{children:[t.jsx(k,{type:"button",variant:"outline",onClick:a,children:"Annuler"}),t.jsx(k,{type:"submit",disabled:l,children:l?"Ouverture...":"Ouvrir la session"})]})]})]})})}function ke(){const e=q.c(32),s=B(),{auth:a}=H().props;let j;e[0]===Symbol.for("react.memo_cache_sentinel")?(j={queryKey:["cash-registers"],queryFn:de},e[0]=j):j=e[0];const{data:l,isLoading:n}=le(j);let d;e[1]!==l?(d=l===void 0?[]:l,e[1]=l,e[2]=d):d=e[2];const b=d,[o,m]=D.useState(!1),[N,r]=D.useState(null);let i;e[3]===Symbol.for("react.memo_cache_sentinel")?(i=F=>{r(F),m(!0)},e[3]=i):i=e[3];const O=i;let x;e[4]!==s?(x=()=>{s.invalidateQueries({queryKey:["cash-registers"]})},e[4]=s,e[5]=x):x=e[5];const w=x;let h;e[6]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx(I,{title:"Gestion de Caisse"}),e[6]=h):h=e[6];let u,p;e[7]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(A,{href:"/manager/shops",children:t.jsx(k,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl border border-white/40 bg-white/50 shadow-sm backdrop-blur-md hover:bg-white/80",children:t.jsx(re,{className:"h-5 w-5 text-pink-600"})})}),p=t.jsx("div",{className:"h-10 w-[1px] bg-pink-100"}),e[7]=u,e[8]=p):(u=e[7],p=e[8]);let f;e[9]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs("div",{className:"flex items-center gap-4",children:[u,p,t.jsxs("div",{className:"flex flex-col",children:[t.jsx("h1",{className:"text-xl font-black tracking-tight text-slate-900",children:"Gestion de Caisse"}),t.jsx("p",{className:"text-xs font-bold text-pink-500 uppercase",children:"Tableau de Bord"})]})]}),e[9]=f):f=e[9];let c;e[10]!==a.user.name?(c=t.jsx("div",{className:"text-sm leading-none font-black text-slate-900",children:a.user.name}),e[10]=a.user.name,e[11]=c):c=e[11];const v=a.user.shop?`• ${a.user.shop}`:"";let g;e[12]!==a.user.role||e[13]!==v?(g=t.jsxs("div",{className:"mt-1 text-[9px] font-black tracking-widest text-slate-400 uppercase",children:[a.user.role," ",v]}),e[12]=a.user.role,e[13]=v,e[14]=g):g=e[14];let y;e[15]!==g||e[16]!==c?(y=t.jsxs("header",{className:"sticky top-0 z-50 mb-10 flex h-24 w-full flex-col gap-6 border-b border-white/20 bg-white/70 px-6 py-4 shadow-sm backdrop-blur-xl md:flex-row md:items-center md:justify-between md:px-10",children:[f,t.jsx("div",{className:"flex items-center gap-6",children:t.jsx("div",{className:"flex items-center gap-4 border-l border-slate-200/50 pl-6",children:t.jsxs("div",{className:"flex flex-col items-end text-right",children:[c,g]})})})]}),e[15]=g,e[16]=c,e[17]=y):y=e[17];let S;e[18]!==n||e[19]!==b?(S=n?t.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(ce)}):t.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[b.map(F=>t.jsx(ie,{register:F,onOpenSession:O},F.id)),b.length===0&&t.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-400",children:[t.jsx(G,{className:"mb-4 h-16 w-16 text-slate-200"}),t.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Aucune caisse trouvée"}),t.jsx("p",{children:"Contactez un administrateur pour configurer une caisse."})]})]}),e[18]=n,e[19]=b,e[20]=S):S=e[20];let C;e[21]!==y||e[22]!==S?(C=t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-pink-50/30 px-6 py-8 md:px-10",children:[y,S]}),e[21]=y,e[22]=S,e[23]=C):C=e[23];let L;e[24]===Symbol.for("react.memo_cache_sentinel")?(L=()=>m(!1),e[24]=L):L=e[24];let _;e[25]!==w||e[26]!==o||e[27]!==N?(_=t.jsx(oe,{isOpen:o,onClose:L,register:N,onSuccess:w}),e[25]=w,e[26]=o,e[27]=N,e[28]=_):_=e[28];let R;return e[29]!==C||e[30]!==_?(R=t.jsxs(K,{currentPageName:"CashMoney",children:[h,C,_]}),e[29]=C,e[30]=_,e[31]=R):R=e[31],R}function ce(e){return t.jsx("div",{className:"h-64 animate-pulse rounded-3xl bg-slate-200"},e)}async function de(){const{data:e}=await z.get("/api/cash/registers");return e}export{ke as default};

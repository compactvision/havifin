import{c as _,j as e,L as D,r as w,a as O,u as E,b as F,H as A}from"./app-pbanxzkV.js";import{B as U}from"./badge-CRwmEF2P.js";import{B as u,t as y}from"./index-TiLAn61d.js";import{h as $}from"./moment-B-YVwB4U.js";import{U as q,A as I,S as P}from"./app-main-q-9un8_Z.js";import{C as B}from"./clock-DhbgHvtU.js";import{H as L}from"./history-BfQUlDU2.js";import{L as H}from"./lock-open-gTa-xTvP.js";import{L as z}from"./lock-BYoibfqQ.js";import{D as Q,a as T,b as K,c as M,d as G,e as V}from"./dialog-DcVD7lGJ.js";import{L as R,I as J}from"./label-Dzmu9PQf.js";import{T as W}from"./textarea-CGzbXU8R.js";import{u as X}from"./users-DA9SA4A4.js";import{A as Y}from"./arrow-left-TFHqvlCV.js";import{P as Z}from"./plus-BSed6RQx.js";/* empty css            */import"./createLucideIcon-Ds7Ig1I2.js";function ee(d){const s=_.c(35),{register:l,onOpenSession:x}=d,a=l.active_session;l.balances;let r;s[0]!==l.name?(r=e.jsx("h3",{className:"text-xl font-black text-slate-900",children:l.name}),s[0]=l.name,s[1]=r):r=s[1];const c=l.shop?.name,m=l.counter?.name||"Sans guichet";let i;s[2]!==c||s[3]!==m?(i=e.jsxs("p",{className:"text-sm text-slate-500",children:[c," •"," ",m]}),s[2]=c,s[3]=m,s[4]=i):i=s[4];let n;s[5]!==r||s[6]!==i?(n=e.jsxs("div",{children:[r,i]}),s[5]=r,s[6]=i,s[7]=n):n=s[7];const h=`/cash/registers/${l.id}/history`;let t;s[8]===Symbol.for("react.memo_cache_sentinel")?(t=e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600",children:e.jsx(L,{className:"h-4 w-4"})}),s[8]=t):t=s[8];let o;s[9]!==h?(o=e.jsx(D,{href:h,children:t}),s[9]=h,s[10]=o):o=s[10];const k=`rounded-full px-2 py-1 text-xs font-black uppercase ${a?"bg-green-100 text-green-600":"bg-slate-100 text-slate-400"}`;let p;s[11]!==a?(p=a?e.jsx(H,{className:"mr-1 h-3 w-3"}):e.jsx(z,{className:"mr-1 h-3 w-3"}),s[11]=a,s[12]=p):p=s[12];const S=a?"Ouverte":"Fermée";let g;s[13]!==p||s[14]!==S||s[15]!==k?(g=e.jsxs(U,{className:k,children:[p,S]}),s[13]=p,s[14]=S,s[15]=k,s[16]=g):g=s[16];let f;s[17]!==g||s[18]!==o?(f=e.jsxs("div",{className:"flex gap-2",children:[o,g]}),s[17]=g,s[18]=o,s[19]=f):f=s[19];let j;s[20]!==f||s[21]!==n?(j=e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[n,f]}),s[20]=f,s[21]=n,s[22]=j):j=s[22];let b;s[23]!==a?(b=a?e.jsxs("div",{className:"space-y-4 rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-100 text-blue-600",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Responsable"}),e.jsxs("div",{className:"font-bold text-slate-900",children:["Caissier #",a.user_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-orange-100 text-orange-600",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase",children:"Ouverte depuis"}),e.jsx("div",{className:"font-bold text-slate-900",children:$(a.opened_at).fromNow()})]})]})]}):e.jsxs("div",{className:"flex min-h-[120px] flex-col items-center justify-center rounded-2xl border-2 border-dashed border-slate-100 bg-slate-50/50 text-center",children:[e.jsx("div",{className:"mb-2 rounded-full bg-slate-100 p-3 text-slate-400",children:e.jsx(L,{className:"h-6 w-6"})}),e.jsx("p",{className:"font-bold text-slate-500",children:"Caisse fermée"})]}),s[23]=a,s[24]=b):b=s[24];let v;s[25]!==a||s[26]!==x||s[27]!==l?(v=a?e.jsx(D,{href:`/cash/sessions/${a.id}`,className:"block w-full",children:e.jsx(u,{className:"h-12 w-full rounded-xl bg-blue-600 font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 hover:shadow-xl",children:"Accéder à la session"})}):e.jsx(u,{onClick:()=>x(l),className:"h-12 w-full rounded-xl bg-slate-900 font-bold text-white shadow-lg shadow-slate-900/20 hover:bg-slate-800 hover:shadow-xl",children:"Ouvrir la caisse"}),s[25]=a,s[26]=x,s[27]=l,s[28]=v):v=s[28];let N;s[29]!==b||s[30]!==v?(N=e.jsxs("div",{className:"space-y-6",children:[b,v]}),s[29]=b,s[30]=v,s[31]=N):N=s[31];let C;return s[32]!==j||s[33]!==N?(C=e.jsxs("div",{className:"group relative overflow-hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-sm transition-all hover:shadow-lg",children:[j,N]}),s[32]=j,s[33]=N,s[34]=C):C=s[34],C}const se=["USD","CDF","EUR"];function te({register:d,isOpen:s,onClose:l,onSuccess:x}){const[a,r]=w.useState(!1),[c,m]=w.useState({USD:"0",CDF:"0",EUR:"0"}),[i,n]=w.useState(""),h=async t=>{if(t.preventDefault(),!!d){r(!0);try{await O.post("/api/cash/sessions",{cash_register_id:d.id,opening_amounts:c,notes:i}),y.success("Session ouverte avec succès"),x(),l()}catch(o){y.error(o.response?.data?.message||"Erreur lors de l'ouverture")}finally{r(!1)}}};return e.jsx(Q,{open:s,onOpenChange:l,children:e.jsxs(T,{className:"sm:max-w-[425px]",children:[e.jsxs(K,{children:[e.jsx(M,{children:"Ouverture de Caisse - Fond de Caisse"}),e.jsxs(G,{children:["Veuillez renseigner le ",e.jsx("strong",{children:"montant prévu"})," ","pour le début de journée (Fond de Caisse) pour"," ",d?.name,".",e.jsx("br",{}),"Ces montants constitueront le solde d'ouverture."]})]}),e.jsxs("form",{onSubmit:h,className:"grid gap-4 py-4",children:[e.jsx("div",{className:"grid gap-4",children:se.map(t=>e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(R,{htmlFor:`amount-${t}`,className:"text-right font-bold",children:t}),e.jsx(J,{id:`amount-${t}`,type:"number",min:"0",step:"0.01",value:c[t],onChange:o=>m({...c,[t]:o.target.value}),className:"col-span-3"})]},t))}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(R,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx(W,{id:"notes",value:i,onChange:t=>n(t.target.value),className:"col-span-3",placeholder:"Remarques éventuelles..."})]}),e.jsxs(V,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:l,children:"Annuler"}),e.jsx(u,{type:"submit",disabled:a,children:a?"Ouverture...":"Ouvrir la session"})]})]})]})})}function ve(){const d=E(),{auth:s}=F().props,{data:l=[],isLoading:x}=X({queryKey:["cash-registers"],queryFn:async()=>{const{data:t}=await O.get("/api/cash/registers");return t}}),[a,r]=w.useState(!1),[c,m]=w.useState(null),i=t=>{m(t),r(!0)},n=()=>{d.invalidateQueries({queryKey:["cash-registers"]})},h=async()=>{try{y.info("Initialisation de la caisse par défaut..."),await O.post("/api/cash/registers",{shop_id:s.user.shop_id||1,name:"Caisse Principale"}),y.success("Caisse configurée avec succès !"),d.invalidateQueries({queryKey:["cash-registers"]})}catch(t){console.error(t),y.error("Erreur lors de la configuration.")}};return e.jsxs(I,{currentPageName:"CashMoney",children:[e.jsx(A,{title:"Gestion de Caisse"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-pink-50/30 px-6 py-8 md:px-10",children:[e.jsxs("header",{className:"sticky top-0 z-50 mb-10 flex h-24 w-full flex-col gap-6 border-b border-white/20 bg-white/70 px-6 py-4 shadow-sm backdrop-blur-xl md:flex-row md:items-center md:justify-between md:px-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{href:"/manager/shops",children:e.jsx(u,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl border border-white/40 bg-white/50 shadow-sm backdrop-blur-md hover:bg-white/80",children:e.jsx(Y,{className:"h-5 w-5 text-pink-600"})})}),e.jsx("div",{className:"h-10 w-[1px] bg-pink-100"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-xl font-black tracking-tight text-slate-900",children:"Gestion de Caisse"}),e.jsx("p",{className:"text-xs font-bold text-pink-500 uppercase",children:"Tableau de Bord"})]})]}),e.jsx("div",{className:"flex items-center gap-6",children:e.jsx("div",{className:"flex items-center gap-4 border-l border-slate-200/50 pl-6",children:e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-sm leading-none font-black text-slate-900",children:s.user.name}),e.jsxs("div",{className:"mt-1 text-[9px] font-black tracking-widest text-slate-400 uppercase",children:[s.user.role," ",s.user.shop?`• ${s.user.shop}`:""]})]})})})]}),x?e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-64 animate-pulse rounded-3xl bg-slate-200"},t))}):e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[l.map(t=>e.jsx(ee,{register:t,onOpenSession:i},t.id)),l.length===0&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center space-y-6 py-20 text-center",children:[e.jsx("div",{className:"rounded-full bg-slate-100 p-8",children:e.jsx(P,{className:"h-16 w-16 text-slate-300"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black tracking-tight text-slate-900 uppercase",children:"Aucune caisse trouvée"}),e.jsx("p",{className:"mt-2 font-medium text-slate-500",children:"Une caisse doit être configurée pour commencer à gérer les fonds."})]}),e.jsxs(u,{onClick:h,className:"h-14 rounded-2xl bg-indigo-600 px-10 text-xs font-black tracking-widest text-white uppercase shadow-lg shadow-indigo-200 transition-all hover:bg-indigo-700 hover:scale-105",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Configurer la Caisse Principale"]})]})]})]}),e.jsx(te,{isOpen:a,onClose:()=>r(!1),register:c,onSuccess:n})]})}export{ve as default};

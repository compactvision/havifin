import{r as je,j as s,a as ke,c as $e,b as qe,u as Ae,H as Oe,L as Be}from"./app-DATWHNMc.js";import{B as Y,t as Re}from"./index-B7jdcb8K.js";import{D as Ie,a as ze,b as Ke,c as Qe,d as Pe,e as Ve}from"./dialog-BYjCO34Z.js";import{L as De,I as Ge}from"./label-CrBfHtu_.js";import{T as Je}from"./textarea-DMtPiRqH.js";import{B as ve}from"./badge-Ci_v76ag.js";import{C as He,a as Ee,b as ge,c as Ne}from"./card-Jn8t6pHs.js";import{T as Fe,a as ee,b as We,c as be,d as Xe,e as Ye}from"./table-kfvaX1XF.js";import{A as Le,U as Ze}from"./app-main-DgyKFYw0.js";import{u as Me}from"./users-N7UzZr7_.js";import{h as Te}from"./moment-B-YVwB4U.js";import{H as es}from"./history-Ct3Xt804.js";import{A as ss}from"./arrow-left-DgxoR9rr.js";import{L as ts}from"./lock-open-DAC-r5Nw.js";import{L as ls}from"./lock-Bfcso9f1.js";import{B as as}from"./banknote-C-Xon-VD.js";import{C as rs}from"./clock-C4KKNSxU.js";import{C as is}from"./circle-check-Ba1eiQHJ.js";import{T as ns}from"./triangle-alert-DxR8XP_o.js";/* empty css            */import"./createLucideIcon-Da68W3hK.js";const cs=["USD","CDF","EUR"];function os({session:l,isOpen:e,onClose:a,onSuccess:_}){const[y,Z]=je.useState(!1),[x,t]=je.useState({USD:"0",CDF:"0",EUR:"0"}),[se,h]=je.useState(""),u=async r=>{if(r.preventDefault(),!!l&&confirm("Êtes-vous sûr de vouloir clôturer cette caisse ? Cette action est irréversible.")){Z(!0);try{await ke.post(`/api/cash-sessions/${l.id}/close`,{closing_amounts:x,notes:se}),Re.success("Session clôturée avec succès"),_(),a()}catch(f){Re.error(f.response?.data?.message||"Erreur lors de la clôture")}finally{Z(!1)}}};return s.jsx(Ie,{open:e,onOpenChange:a,children:s.jsxs(ze,{className:"sm:max-w-[425px]",children:[s.jsxs(Ke,{children:[s.jsx(Qe,{children:"Clôture de Caisse"}),s.jsxs(Pe,{children:["Veuillez compter et saisir le solde RÉEL pour la session #",l?.id,". Tout écart sera enregistré."]})]}),s.jsxs("form",{onSubmit:u,className:"grid gap-4 py-4",children:[s.jsx("div",{className:"grid gap-4",children:cs.map(r=>s.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(De,{htmlFor:`close-amount-${r}`,className:"text-right font-bold",children:r}),s.jsx(Ge,{id:`close-amount-${r}`,type:"number",min:"0",step:"0.01",value:x[r],onChange:f=>t({...x,[r]:f.target.value}),className:"col-span-3"})]},r))}),s.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[s.jsx(De,{htmlFor:"close-notes",className:"text-right",children:"Notes"}),s.jsx(Je,{id:"close-notes",value:se,onChange:r=>h(r.target.value),className:"col-span-3",placeholder:"Remarques sur la clôture..."})]}),s.jsxs(Ve,{children:[s.jsx(Y,{type:"button",variant:"outline",onClick:a,children:"Annuler"}),s.jsx(Y,{type:"submit",variant:"destructive",disabled:y,children:y?"Clôture...":"Clôturer la Caisse"})]})]})]})})}function $s(l){const e=$e.c(122),{id:a}=l;qe();const _=Ae(),[y,Z]=je.useState(!1);let x;e[0]!==a?(x={queryKey:["cash-session",a],queryFn:async()=>{const{data:n}=await ke.get(`/api/cash-sessions/${a}`);return n}},e[0]=a,e[1]=x):x=e[1];const{data:t,isLoading:se}=Me(x);let h,u;e[2]!==a?(h=["cash-movements",a],u=async()=>{const{data:n}=await ke.get(`/api/cash-sessions/${a}/movements`);return n.data},e[2]=a,e[3]=h,e[4]=u):(h=e[3],u=e[4]);const r=!!t;let f;e[5]!==h||e[6]!==u||e[7]!==r?(f={queryKey:h,queryFn:u,enabled:r},e[5]=h,e[6]=u,e[7]=r,e[8]=f):f=e[8];const{data:te}=Me(f);let le;e[9]!==te?(le=te===void 0?[]:te,e[9]=te,e[10]=le):le=e[10];const c=le;let ae;e[11]!==a||e[12]!==_?(ae=()=>{_.invalidateQueries({queryKey:["cash-session",a]}),_.invalidateQueries({queryKey:["cash-registers"]})},e[11]=a,e[12]=_,e[13]=ae):ae=e[13];const _e=ae;if(se||!t){let n;return e[14]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(Le,{currentPageName:"CashMoney",children:s.jsx("div",{className:"flex h-screen items-center justify-center",children:"Chargement..."})}),e[14]=n):n=e[14],n}const i=t.status==="open";let re;e[15]!==i||e[16]!==c||e[17]!==t.amounts?(re=n=>{const M=t.amounts?.find(v=>v.currency===n);if(!M)return null;const U=parseFloat(M.opening_amount),o=M.closing_amount_real?parseFloat(M.closing_amount_real):null,N=c.filter(v=>v.currency===n),d=N.filter(fs).reduce(us,0),$=N.filter(hs).reduce(xs,0),q=U+d-$,m=o!==null?o-q:null;return{currency:n,opening:U,totalIn:d,totalOut:$,theoretical:q,closingReal:o,difference:m,status:!i&&o!==null?Math.abs(m)<.01?"perfect":"mismatch":"pending"}},e[15]=i,e[16]=c,e[17]=t.amounts,e[18]=re):re=e[18];const ye=re;let w,C,S,k,p,b,j,F,g;if(e[19]!==ye||e[20]!==i||e[21]!==t.closed_at||e[22]!==t.id||e[23]!==t.opened_at||e[24]!==t.register?.name||e[25]!==t.register?.shop?.name||e[26]!==t.user?.name||e[27]!==t.user_id){const M=["USD","CDF","EUR"].map(Ue=>ye(Ue)).filter(Boolean);w=Le,F="CashMoney";const U=`Session #${t.id}`;e[37]!==U?(g=s.jsx(Oe,{title:U}),e[37]=U,e[38]=g):g=e[38],k="min-h-screen bg-gradient-to-br from-slate-50 via-white to-pink-50/30 px-6 py-8 md:px-10";let o,N;e[39]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(Be,{href:"/cash/dashboard",children:s.jsx(Y,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl border border-white/40 bg-white/50 shadow-sm backdrop-blur-md hover:bg-white/80",children:s.jsx(ss,{className:"h-5 w-5 text-pink-600"})})}),N=s.jsx("div",{className:"h-10 w-[1px] bg-pink-100"}),e[39]=o,e[40]=N):(o=e[39],N=e[40]);let d;e[41]!==t.id?(d=s.jsxs("h1",{className:"text-xl font-black tracking-tight text-slate-900",children:["Session #",t.id]}),e[41]=t.id,e[42]=d):d=e[42];const $=i?"default":"secondary",q=i?"bg-green-500 hover:bg-green-600":"bg-slate-200 text-slate-600";let m;e[43]!==i?(m=i?s.jsx(ts,{className:"mr-1 h-3 w-3"}):s.jsx(ls,{className:"mr-1 h-3 w-3"}),e[43]=i,e[44]=m):m=e[44];const v=i?"OUVERTE":"CLÔTURÉE";let A;e[45]!==$||e[46]!==q||e[47]!==m||e[48]!==v?(A=s.jsxs(ve,{variant:$,className:q,children:[m,v]}),e[45]=$,e[46]=q,e[47]=m,e[48]=v,e[49]=A):A=e[49];let O;e[50]!==d||e[51]!==A?(O=s.jsxs("div",{className:"flex items-center gap-2",children:[d,A]}),e[50]=d,e[51]=A,e[52]=O):O=e[52];const we=t.register?.name,Ce=t.register?.shop?.name;let B;e[53]!==we||e[54]!==Ce?(B=s.jsxs("p",{className:"text-xs font-bold text-pink-500 uppercase",children:[we," •"," ",Ce]}),e[53]=we,e[54]=Ce,e[55]=B):B=e[55];let I;e[56]!==O||e[57]!==B?(I=s.jsxs("div",{className:"flex items-center gap-4",children:[o,N,s.jsxs("div",{className:"flex flex-col",children:[O,B]})]}),e[56]=O,e[57]=B,e[58]=I):I=e[58];let z;e[59]!==i?(z=i&&s.jsxs(s.Fragment,{children:[s.jsxs(Y,{className:"h-11 rounded-xl bg-white text-slate-700 shadow-sm ring-1 ring-slate-200 hover:bg-slate-50",children:[s.jsx(as,{className:"mr-2 h-4 w-4"}),"Ajouter Mouvement"]}),s.jsx(Y,{onClick:()=>Z(!0),className:"h-11 rounded-xl bg-gradient-to-r from-pink-600 to-rose-600 font-bold text-white shadow-lg shadow-pink-500/30 hover:shadow-xl",children:"Clôturer la Session"})]}),e[59]=i,e[60]=z):z=e[60];let K;e[61]!==z?(K=s.jsx("div",{className:"flex items-center gap-3",children:z}),e[61]=z,e[62]=K):K=e[62],e[63]!==I||e[64]!==K?(p=s.jsxs("header",{className:"sticky top-0 z-50 mb-10 flex h-24 w-full flex-col gap-6 border-b border-white/20 bg-white/70 px-6 py-4 shadow-sm backdrop-blur-xl md:flex-row md:items-center md:justify-between md:px-10",children:[I,K]}),e[63]=I,e[64]=K,e[65]=p):p=e[65];let de;e[66]===Symbol.for("react.memo_cache_sentinel")?(de=s.jsx(He,{className:"pb-2",children:s.jsx(Ee,{className:"text-sm font-bold text-slate-400 uppercase",children:"Responsable"})}),e[66]=de):de=e[66];let me;e[67]===Symbol.for("react.memo_cache_sentinel")?(me=s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-indigo-50 text-indigo-600",children:s.jsx(Ze,{className:"h-6 w-6"})}),e[67]=me):me=e[67];const Se=t.user?.name||`User #${t.user_id}`;let Q;e[68]!==Se?(Q=s.jsx("p",{className:"font-black text-slate-900",children:Se}),e[68]=Se,e[69]=Q):Q=e[69];let xe;e[70]===Symbol.for("react.memo_cache_sentinel")?(xe=s.jsx("p",{className:"text-xs font-bold text-slate-400",children:"Caissier"}),e[70]=xe):xe=e[70];let P;e[71]!==Q?(P=s.jsxs(ge,{className:"rounded-3xl border-slate-200/60 shadow-sm",children:[de,s.jsx(Ne,{children:s.jsxs("div",{className:"flex items-center gap-4",children:[me,s.jsxs("div",{children:[Q,xe]})]})})]}),e[71]=Q,e[72]=P):P=e[72];let he;e[73]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx(He,{className:"pb-2",children:s.jsx(Ee,{className:"text-sm font-bold text-slate-400 uppercase",children:"Horaire"})}),e[73]=he):he=e[73];let ue;e[74]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-blue-50 text-blue-600",children:s.jsx(rs,{className:"h-6 w-6"})}),e[74]=ue):ue=e[74];let V;e[75]!==t.opened_at?(V=Te(t.opened_at).format("HH:mm"),e[75]=t.opened_at,e[76]=V):V=e[76];let G;e[77]!==V?(G=s.jsx("p",{className:"font-bold text-slate-900",children:V}),e[77]=V,e[78]=G):G=e[78];let fe;e[79]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("p",{className:"text-xs font-bold text-slate-400",children:"Ouverture"}),e[79]=fe):fe=e[79];let J;e[80]!==G?(J=s.jsxs("div",{children:[G,fe]}),e[80]=G,e[81]=J):J=e[81];let W;e[82]!==t.closed_at?(W=t.closed_at&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"h-8 w-[1px] bg-slate-100"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold text-slate-900",children:Te(t.closed_at).format("HH:mm")}),s.jsx("p",{className:"text-xs font-bold text-slate-400",children:"Fermeture"})]})]}),e[82]=t.closed_at,e[83]=W):W=e[83];let X;e[84]!==J||e[85]!==W?(X=s.jsxs(ge,{className:"rounded-3xl border-slate-200/60 shadow-sm",children:[he,s.jsx(Ne,{children:s.jsxs("div",{className:"flex items-center gap-4",children:[ue,J,W]})})]}),e[84]=J,e[85]=W,e[86]=X):X=e[86];let pe;e[87]===Symbol.for("react.memo_cache_sentinel")?(pe=s.jsx(ge,{className:"col-span-2 rounded-3xl border-slate-200/60 bg-slate-900 text-white shadow-sm",children:s.jsxs(Ne,{className:"flex h-full items-center justify-between p-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-black",children:"Besoin d'aide ?"}),s.jsx("p",{className:"text-sm text-slate-400",children:"Contactez un manager si vous constatez une erreur."})]}),s.jsx(Y,{variant:"outline",className:"border-slate-700 bg-slate-800 text-white hover:bg-slate-700 hover:text-white",children:"Signaler un problème"})]})}),e[87]=pe):pe=e[87],e[88]!==P||e[89]!==X?(b=s.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-4",children:[P,X,pe]}),e[88]=P,e[89]=X,e[90]=b):b=e[90],e[91]===Symbol.for("react.memo_cache_sentinel")?(j=s.jsx("h2",{className:"mb-6 text-2xl font-black text-slate-900",children:"État de la Caisse"}),e[91]=j):j=e[91],C="mb-10 grid grid-cols-1 gap-6 lg:grid-cols-3",S=M.map(ms),e[19]=ye,e[20]=i,e[21]=t.closed_at,e[22]=t.id,e[23]=t.opened_at,e[24]=t.register?.name,e[25]=t.register?.shop?.name,e[26]=t.user?.name,e[27]=t.user_id,e[28]=w,e[29]=C,e[30]=S,e[31]=k,e[32]=p,e[33]=b,e[34]=j,e[35]=F,e[36]=g}else w=e[28],C=e[29],S=e[30],k=e[31],p=e[32],b=e[33],j=e[34],F=e[35],g=e[36];let T;e[92]!==C||e[93]!==S?(T=s.jsx("div",{className:C,children:S}),e[92]=C,e[93]=S,e[94]=T):T=e[94];let ie;e[95]===Symbol.for("react.memo_cache_sentinel")?(ie=s.jsx("h2",{className:"mb-6 text-2xl font-black text-slate-900",children:"Historique des Mouvements"}),e[95]=ie):ie=e[95];let ne;e[96]===Symbol.for("react.memo_cache_sentinel")?(ne=s.jsx(We,{children:s.jsxs(Fe,{children:[s.jsx(be,{children:"Heure"}),s.jsx(be,{children:"Type"}),s.jsx(be,{children:"Description"}),s.jsx(be,{children:"Montant"})]})}),e[96]=ne):ne=e[96];let R;e[97]!==c?(R=c.map(ds),e[97]=c,e[98]=R):R=e[98];let D;e[99]!==c.length?(D=c.length===0&&s.jsx(Fe,{children:s.jsxs(ee,{colSpan:4,className:"py-12 text-center text-slate-400",children:[s.jsx(es,{className:"mx-auto mb-3 h-12 w-12 text-slate-200"}),"Aucun mouvement enregistré pour cette session."]})}),e[99]=c.length,e[100]=D):D=e[100];let H;e[101]!==R||e[102]!==D?(H=s.jsx("div",{className:"rounded-3xl border border-slate-200/60 bg-white p-6 shadow-sm",children:s.jsxs(Xe,{children:[ne,s.jsxs(Ye,{children:[R,D]})]})}),e[101]=R,e[102]=D,e[103]=H):H=e[103];let E;e[104]!==k||e[105]!==p||e[106]!==b||e[107]!==j||e[108]!==T||e[109]!==H?(E=s.jsxs("div",{className:k,children:[p,b,j,T,ie,H]}),e[104]=k,e[105]=p,e[106]=b,e[107]=j,e[108]=T,e[109]=H,e[110]=E):E=e[110];let ce;e[111]===Symbol.for("react.memo_cache_sentinel")?(ce=()=>Z(!1),e[111]=ce):ce=e[111];let L;e[112]!==_e||e[113]!==y||e[114]!==t?(L=s.jsx(os,{isOpen:y,onClose:ce,session:t,onSuccess:_e}),e[112]=_e,e[113]=y,e[114]=t,e[115]=L):L=e[115];let oe;return e[116]!==w||e[117]!==F||e[118]!==g||e[119]!==E||e[120]!==L?(oe=s.jsxs(w,{currentPageName:F,children:[g,E,L]}),e[116]=w,e[117]=F,e[118]=g,e[119]=E,e[120]=L,e[121]=oe):oe=e[121],oe}function ds(l){return s.jsxs(Fe,{children:[s.jsx(ee,{className:"font-bold text-slate-500",children:Te(l.created_at).format("HH:mm")}),s.jsx(ee,{children:s.jsx(ve,{variant:"outline",className:"text-[10px] tracking-wider uppercase",children:l.type})}),s.jsx(ee,{className:"font-medium text-slate-700",children:l.description}),s.jsx(ee,{children:s.jsxs("span",{className:`font-black ${parseFloat(l.amount)<0?"text-red-500":"text-green-500"}`,children:[parseFloat(l.amount)>0?"+":"",l.amount," ",l.currency]})})]},l.id)}function ms(l){return s.jsxs(ge,{className:"overflow-hidden rounded-3xl border-slate-200/60 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-4",children:[s.jsx("span",{className:"font-black text-slate-500",children:l.currency}),l.status==="perfect"&&s.jsxs(ve,{className:"bg-green-100 text-green-700 hover:bg-green-100",children:[s.jsx(is,{className:"mr-1 h-3 w-3"})," ","OK"]}),l.status==="mismatch"&&s.jsxs(ve,{className:"bg-red-100 text-red-700 hover:bg-red-100",children:[s.jsx(ns,{className:"mr-1 h-3 w-3"})," ","ÉCART"]})]}),s.jsxs(Ne,{className:"p-0",children:[s.jsxs("div",{className:"grid grid-cols-2 divide-x divide-slate-100 border-b border-slate-100",children:[s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Ouverture"}),s.jsx("p",{className:"text-lg font-bold text-slate-700",children:l.opening.toFixed(2)})]}),s.jsxs("div",{className:"bg-slate-50/50 p-4",children:[s.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Théorique"}),s.jsx("p",{className:"text-lg font-bold text-slate-900",children:l.theoretical.toFixed(2)})]})]}),s.jsxs("div",{className:"grid grid-cols-2 divide-x divide-slate-100",children:[s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs font-bold text-green-500 uppercase",children:"Entrées"}),s.jsxs("p",{className:"font-bold text-green-600",children:["+",l.totalIn.toFixed(2)]})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-xs font-bold text-red-500 uppercase",children:"Sorties"}),s.jsxs("p",{className:"font-bold text-red-600",children:["-",l.totalOut.toFixed(2)]})]})]}),l.closingReal!==null&&s.jsx("div",{className:`border-t border-slate-100 p-4 ${Math.abs(l.difference)>.01?"bg-red-50":"bg-green-50"}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Réel (Compté)"}),s.jsx("p",{className:"text-xl font-black text-slate-900",children:l.closingReal.toFixed(2)})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Écart"}),s.jsxs("p",{className:`text-xl font-black ${Math.abs(l.difference)>.01?"text-red-600":"text-green-600"}`,children:[l.difference>0?"+":"",l.difference.toFixed(2)]})]})]})})]})]},l.currency)}function xs(l,e){return l+Math.abs(parseFloat(e.amount))}function hs(l){return parseFloat(l.amount)<0}function us(l,e){return l+parseFloat(e.amount)}function fs(l){return parseFloat(l.amount)>0}export{$s as default};
